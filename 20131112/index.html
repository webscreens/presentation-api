<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Presentation API</title>
  <style>
   @media print {
     [data-anolis-spec]::after { content:"[" attr(data-anolis-spec) "]"; font-size:.6em; vertical-align:super; text-transform:uppercase }
   }
  </style>

  <link href="http://www.w3.org/community/src/css/spec/cg-draft.css" type="text/css" rel="stylesheet">
  <style type="text/css">
    /* Note formatting taken from HTML5 spec */
    .note { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #E9FBE9; border-color: #52E052; }
    .note em, .warning em, .note i, .warning i { font-style: normal; }
    p.note, div.note { padding: 0.5em 2em; }
    span.note { padding: 0 2em; }
    .note p:first-child { margin-top: 0; }
    .note p:last-child { margin-bottom: 0; }
    p.note:before { content: 'Note: '; font-weight: bolder;}

    .open-issue { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #fbfbe9; border-color: #faf9a5; }
    .open-issue em, .warning em, .open-issue i, .warning i { font-style: normal; }
    p.open-issue, div.open-issue { padding: 0.5em 2em; }
    span.open-issue { padding: 0 2em; }
    .open-issue p:first-child { margin-top: 0; }
    .open-issue p:last-child { margin-bottom: 0; }
    p.open-issue:before { content: 'Open issue: '; font-weight: bolder;}

    .non-normative { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #E9FBE9; border-color: #52E052; }
    p.non-normative:before { content: 'Non-normative: '; font-weight: bolder;}
    p.non-normative, div.non-normative { padding: 0.5em 2em; }


    /* Pre.idl formatting taken from HTML5 spec */
    pre.idl { border: solid thin #d3d3d3; background: #FCFCFC; color: black; padding: 0.5em 1em; position: relative; }
    pre.idl :link, pre.idl :visited { color: inherit; background: transparent; }
    pre.idl::before { content: "IDL"; font: bold small sans-serif;
    padding: 0.5em; background: white; position: absolute; top: 0;
    margin: -1px 0 0 -4em; width: 1.5em; border: thin solid;
    border-radius: 0 0 0 0.5em }

    /* .example idl formatting taken from HTML5 nightly spec */
    .example {
        display: block;
        color: #222222;
        background: #FCFCFC;
        border-left-style: solid;
        border-color: #c0c0c0;
        border-left-width: 0.25em;
        margin-left: 1em;
        padding-left: 1em;
        padding-bottom: 0.5em;
    }

    .algorithm li {
        margin-bottom: 0.5em;
    }

    .interface dd, .parameters dt {
        margin-bottom: 0.5em;
    }

    code { color: orangered; }
  </style>
 </head>
 <body>

<div class="head">
 
<!--begin-logo-->
<p><a href="http://www.w3.org/"><img width="72" alt="W3C" height="48" src="https://www.w3.org/Icons/w3c_home"></a></p>
<!--end-logo-->
 <h1>Presentation API</h1>
<h2 class="no-num no-toc">Draft Report 12 November 2013</h2>

 <dl>
  <dt>This Version:
  <dd><!--begin-link--><a href="http://webscreens.github.io/presentation-api/20131112/">http://webscreens.github.io/presentation-api/20131112/</a><!--end-link-->


  <dt>Latest Editor's Draft
  <dd><!--begin-link--><a href="http://webscreens.github.io/presentation-api/">http://webscreens.github.io/presentation-api/</a><!--end-link-->

  <dt>Participate:</dt>
  <dd>Send feedback to the community group's mailing
  list <a href="http://lists.w3.org/Archives/Public/public-webscreens/">public-webscreens@w3.org</a>,
  or <a href="https://github.com/webscreens/presentation-api/issues">create or browse open issues</a> on GitHub. Also,
  you may join on the <a href="irc://irc.w3.org:6665/#webscreens">CG's IRC channel</a>.

  <dt>Version History:
  <dd><!--begin-link--><a href="https://github.com/webscreens/presentation-api/commits/">https://github.com/webscreens/presentation-api/commits/</a><!--end-link--></dd>

  <dt>Editors:
      <dd><a href="mailto:dominik.rottsches@intel.com">Dominik Röttsches</a>, Intel</dd>
      <dd><a href="mailto:hongbo.min@intel.com">闵洪波 (Hongbo Min)</a>, Intel</dd>
 </dl>


<p class="copyright">
    <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2014 the Contributors to the
    Presentation API Specification, published by the <a href="http://www.w3.org/community/webscreens/">Second Screen
    Presentation Community Group</a> under the
    <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
    A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available.
</p>

<hr>

</div>


<h2 class="no-num no-toc" id="abstract">Abstract</h2>
<p>This specification defines an API to enable web content to access external
      presentation-type displays and use them for presenting web content.</p>


<h2 class="no-num no-toc" id="sotd">Status of this Document</h2>

<p>This specification was published by
the <a href="http://www.w3.org/community/webscreens/">Second Screen Presentation
Community Group</a>. It is not a W3C Standard nor is it on the W3C Standards
Track. Please note that under the
W3C <a href="http://www.w3.org/community/about/agreements/cla/">Community
Contributor License Agreement (CLA)</a> there is a limited opt-out and other
conditions apply. Learn more about <a href="http://www.w3.org/community/">W3C
Community and Business Groups</a>.</p>

<!--
<p><em>This section describes the status of this document at the time of its
publication. Other documents may supersede this document. A list of current
W3C publications and the latest revision of this technical report can be
found in the <a href="http://www.w3.org/TR/">W3C technical reports index</a>
at http://www.w3.org/TR/.</em></p>

<p>This is the 12 November 2013 Editor's Draft of Presentation API. The W3C Membership
and other interested parties are invited to review the document and send
comments to <a href="mailto:public-webapps@w3.org">public-webapps@w3.org</a>
(<a href="http://lists.w3.org/Archives/Public/public-webapps/">public archive</a>)
or to <a href="mailto:www-dom@w3.org">www-dom@w3.org</a>
(<a href="http://lists.w3.org/Archives/Public/www-dom/">public archive</a>).</p>

<p>Implementors should be aware that this specification is not stable.
<strong>Implementors who are not taking part in the discussions are likely
to find the specification changing out from under them in incompatible
ways.</strong> Vendors interested in implementing this specification
before it eventually reaches the Candidate Recommendation stage should
join the aforementioned mailing lists and take part in the discussions.

<p>This document is published by the <a href="http://www.w3.org/2008/webapps/">Web
Applications Working Group</a> in co-operation with
the <a href="http://www.whatwg.org/">Web Hypertext Application
Technology Working Group</a>.  The Working Group expects to advance
this Working Draft to Recommendation Status.</p> -->

<!-- <p>Publication as a Working Draft does not imply endorsement by the W3C
Membership. This is a draft document and may be updated, replaced or
obsoleted by other documents at any time. It is inappropriate to cite this
document as other than work in progress.</p> -->

<!-- TODO: Insert patent policy -->

<h2 class="no-num no-toc" id="table-of-contents">Table of Contents</h2>

<!--begin-toc-->
<ol class="toc">
 <li><a href="#introduction"><span class="secno">1 </span>Introduction</a>
  <ol>
   <li><a href="#use-cases"><span class="secno">1.1 </span>Use Cases</a>
    <ol>
     <li><a href="#presentations"><span class="secno">1.1.1 </span>Presentations</a></li>
     <li><a href="#video-and-image-sharing"><span class="secno">1.1.2 </span>Video and Image Sharing</a></li>
     <li><a href="#gaming"><span class="secno">1.1.3 </span>Gaming</a></ol></li>
   <li><a href="#example"><span class="secno">1.2 </span>Example</a></ol></li>
 <li><a href="#conformance"><span class="secno">2 </span>Conformance</a></li>
 <li><a href="#terminology"><span class="secno">3 </span>Terminology</a></li>
 <li><a href="#presentation-extension-to-navigator"><span class="secno">4 </span>Presentation Extension to Navigator</a></li>
 <li><a href="#presentation-interface"><span class="secno">5 </span>Presentation Interface</a></li>
 <li><a href="#display-selection-and-availability"><span class="secno">6 </span>Display Selection and Availability</a>
  <ol>
   <li><a href="#monitoring-for-availability-changes"><span class="secno">6.1 </span>Monitoring for Availability Changes</a></ol></li>
 <li><a href="#requesting-a-presentation-display"><span class="secno">7 </span>Requesting a Presentation Display</a></li>
 <li><a href="#lifecycle-and-visibility-of-the-presentation-window"><span class="secno">8 </span>Lifecycle and Visibility of the Presentation Window</a>
  <ol>
   <li><a href="#user-closing-the-presentation-window"><span class="secno">8.1 </span>User Closing the Presentation Window</a></li>
   <li><a href="#programmatic-closing-of-the-presentation-window"><span class="secno">8.2 </span>Programmatic Closing of the Presentation Window</a></li>
   <li><a href="#display-availability-changes"><span class="secno">8.3 </span>Display Availability Changes</a></li>
   <li><a href="#close-on-unload"><span class="secno">8.4 </span>Close on Unload</a></ol></li>
 <li><a href="#security-considerations"><span class="secno">9 </span>Security Considerations</a></li>
 <li><a href="#references" class="no-num">References</a></li>
 <li><a href="#acknowledgements" class="no-num">Acknowledgements</a></ol>
<!--end-toc-->

<h2 id="introduction"><span class="secno">1 </span>Introduction</h2>

<em>This section is non-normative.</em>

<p>This specification aims to make secondary displays such as a projector or a connected TV available to the web and
takes into account displays that are attached using wired (HDMI, DVI or similar) and wireless technologies (MiraCast, DLNA,
AirPlay or similar).</p>

<p>Devices with limited screen size lack the ability to show content
to a larger audience, for example a group of colleagues in a
conference room, or friends and family at home. Showing content on an
external large display helps to improve the perceived quality and
impact of the presented content.</p>

<p>It is the intention of this specification that the user agent prepares a rendering for the secondary display in a way
    that is adapted to the secondary display's capabilities. The DOM state and the rendering shown on the primary and
    secondary display are maintained and performed by the same user agent. There is no secondary user agent involved
    that would run remotely on the secondary display.</p>

<p>The user agent creates two browsing contexts, one on the primary display, one on the selected presentation
    display. It is responsible for sending the rendered output to the secondary display. For wirelessly-connected
    displays this may mean that the user agent prepares a video stream from the rendering output that is sent over the
    network to the wireless display.</p>

<p>The trend in user agent implementations has been to avoid opening
multiple separate windows and containing window management to tabs,
which helps the user to organize multiple pages. However, the
following example <a href="#use-cases">use cases</a> fall outside the regular
management of multiple windows for web pages.</p>

<h3 id="use-cases"><span class="secno">1.1 </span>Use Cases</h3>

<h4 id="presentations"><span class="secno">1.1.1 </span>Presentations</h4>

<p>A user is preparing a set of slides for a talk. Using a web based
service, she is editing her slides and speaker notes on the primary
screen, while the secondary larger screen shows a preview of the
current slide. When the slides are done, her mobile phone allows her
to access them from an online service while on the go. Coming
to the conference, using wireless display technology, she would like
to present her slides on the stage screen from her mobile phone. The
phone's touch screen helps her to navigate slides and presents a slide
preview, while the projector shows her slides to
the audience.</p>

<h4 id="video-and-image-sharing"><span class="secno">1.1.2 </span><a id="video-sharing">Video and Image Sharing</a></h4>

<p>Using an online video or image sharing service, a user would like to show memorable moments to her friends. Using a
device with a small screen, it is impossible to show the content to a large group of people. Connecting an external TV
screen or projector to her device - with a cable or wirelessly - the online sharing service now makes use of the
connected display, allowing a wider audience to enjoy the content.</p>

<h4 id="gaming"><span class="secno">1.1.3 </span>Gaming</h4>

<p>Splitting the gaming experience into a near screen controller and a
large screen visual experience, new gaming experiences can be
created. Accessing the local display on the small screen device and an
external larger display allows for richer web-based gaming
experiences.</p>

<h3 id="example"><span class="secno">1.2 </span>Example</h3>

<p>Running in a compliant user agent, code for playing a video on the presentation display could look like the following:</p>

<pre class="example">/* player.html */

&lt;video&gt;
&lt;script&gt;
var v = document.querySelector('video');

window.onmessage = function (event) {
  v.src = event.data;
  v.play();
};
&lt;/script&gt;
</pre>

<pre class="example">/* controller.html */

&lt;script&gt;
function playVideo() {
  if (!navigator.presentation.displayAvailable)
    return;
  var p = navigator.presentation.requestShow('player.html');
  p.then(function (display) { display.postMessage('http://example.org/video.mp4', '/'); },
         function (error) { console.log('Request to show failed: ' + error.msg); }
  );
}

playVideo();

&lt;/script&gt;
</pre>

<p>In this example of a video player scenario similar to the <a href="#video-sharing">video sharing use case</a>
    presented above, the opener browsing context loads a document into the presentation browsing context which has a
    video element in it and communicates with it through <code>postMessage</code>. The document of the presentation
    browsing context receives the commands and for example sets the <code>src</code> attribute of the video and starts
    playing it.</p>

<p>The example uses <code>postMessage</code> for communication between opener and auxiliary browsing context in order to
encourage the use of asynchronous, potentially cross-origin communication between the two contexts. Direct access to
properties of the <code>document</code> object in the auxiliary browsing context is an alternative option in case the
documents are loaded from the same origin.</p>

<pre class="example">&lt;script&gt;

/* Monitoring availability */
navigator.presentation.ondisplayavailablechange = function() {
  /* For example: Enable/Disable UI to show content on presentation display here. */
  var availability = navigator.presentation.displayAvailable ? "available" : "unavailable";
  console.log("Presentation display is now " + availability + ".");
}

&lt;/script&gt;
</pre>

<p>This example demonstrates the auxiliary use case of monitoring for available secondary displays in order to keep the
    UI consistent. The <code>displayavailablechange</code> event informs about displays appearing or disappearing and
    allows the client of the API to update page content accordingly.</p>

<h2 id="conformance"><span class="secno">2 </span>Conformance</h2>
<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
"OPTIONAL" in this document are to be interpreted as described in RFC 2119.
For readability, these words do not appear in all uppercase letters in this
specification. <a href="#refsRFC2119">[RFC2119]</a>

<p>Requirements phrased in the imperative as part of algorithms
(such as "strip any leading space characters" or "return false and
terminate these steps") are to be interpreted with the meaning of the
key word ("must", "should", "may", etc.) used in introducing the
algorithm.

<p>Conformance requirements phrased as algorithms or specific steps
may be implemented in any manner, so long as the end result is
equivalent. (In particular, the algorithms defined in this
specification are intended to be easy to follow, and not intended to
be performant.)

<h2 id="terminology"><span class="secno">3 </span>Terminology</h2>

<p>The term <dfn title="presentation display" id="presentation-display">presentation display</dfn> refers to an external screen connected to the device that the user agent runs on.</p>

<p>The terms <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#opener-browsing-context" data-anolis-spec="w3c-html" title="opener-browsing-context" class="external">opener browsing context</a>
    and <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#auxiliary-browsing-context" data-anolis-spec="w3c-html" title="auxiliary browsing context" class="external">auxiliary browsing context</a> are defined
    in <a href="#refsHTML5">[HTML5]</a>.

<p>The terms <a href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#event-handlers" data-anolis-spec="w3c-html" class="external">event handlers</a>
  and <a href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#event-handler-event-type" data-anolis-spec="w3c-html" title="event handler event type" class="external">event handler event types</a> are
  defined in <a href="#refsHTML5">[HTML5]</a>.</p>

<p>The <a href="http://dom.spec.whatwg.org/#promises" data-anolis-spec="dom" title="concept-promises" class="external">Promises model</a> and the <span title="concept-event-fire">concept of event firing</span> are defined in
    the <a href="#refsDOM">[DOM]</a> living standard.</p>

<p>This document provides interface definitions using the <a href="#refsWEBIDL">[WEBIDL]</a> standard.

<p>The <a href="http://fetch.spec.whatwg.org/#concept-basic-fetch" data-anolis-spec="fetch" title="concept-basic-fetch" class="external">basic fetch algorithm</a> is defined in
    <a href="#refsFETCH">[FETCH]</a>.

<h2 id="presentation-extension-to-navigator"><span class="secno">4 </span>Presentation Extension to Navigator</h2>
<pre class="idl">partial interface Navigator {
  readonly attribute <a href="#presentation-idl" title="presentation-idl">Presentation</a> <dfn title="presentation-property" id="presentation-property">presentation</dfn>;

};
</pre>

<h2 id="presentation-interface"><span class="secno">5 </span>Presentation Interface</h2>

<pre class="idl">interface <dfn title="presentation-idl" id="presentation-idl">Presentation</dfn> : <a href="http://dom.spec.whatwg.org/#eventtarget" data-anolis-spec="dom" title="eventtarget" class="external">EventTarget</a> {
  <a href="http://dom.spec.whatwg.org/#promises" data-anolis-spec="dom" title="concept-promises" class="external">Promise</a> <dfn title="requestShow" id="requestshow">requestShow(optional <span data-anolis-spec="webidl" title="domstring" class="external">DOMString</span> url = "about:blank")</dfn>;

  readonly attribute boolean <dfn title="displayAvailable" id="displayavailable">displayAvailable</dfn>;
  attribute <a href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#eventhandler" data-anolis-spec="w3c-html" title="eventhandler" class="external">EventHandler</a> <dfn title="ondisplayavailablechange" id="ondisplayavailablechange">ondisplayavailablechange</dfn>;
};
</pre>

<dl class="interface">
    <dt><a href="#requestshow"><code>requestShow</code></a></dt>
    <dd><p>Method to request opening and showing a new <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#browsing-context" data-anolis-spec="w3c-html" title="browsing context" class="external">browsing
                context</a> on the <span title="selected-presentation-display">selected presentation display</span>.</p>
        <p><strong>Parameters:</strong></p>
        <dl>
            <dt><code>optional DOMString url</code></dt>
            <dd>URL of the page that is to be loaded in the new browsing context.</dd>
        </dl>
        <p><strong>Returns:</strong></p>
        <dl>
            <dt><code>Promise</code></dt>
            <dd><p><a href="http://dom.spec.whatwg.org/#promises" data-anolis-spec="dom" title="concept-promises" class="external">Promise</a> that is fulfilled when the request was successful,
                    rejected if it failed.</dd>
        </dl>
    </dd>
    <dt><a href="#displayavailable"><code>displayAvailable</code></a></dt>
    <dd><p>A boolean flag to indicate the secondary display availability in the UA. Updated when the display availability changes.
           True if there is at least one available secondary display for the <a href="#use-cases">mentioned use
           cases</a>, false otherwise.</p>
    </dd>
</dl>

<h2 id="display-selection-and-availability"><span class="secno">6 </span>Display Selection and Availability</h2>

<p>If at least one event listener is registered to
the <a href="#ondisplayavailablechange" title="ondisplayavailablechange"><code>ondisplayavailablechange</code></a> event handler the user agent
should start <a href="#availability-monitoring" title="availability-monitoring">monitoring for the availability of secondary displays</a> suitable
for the for the <a href="#use-cases">mentioned use cases</a>.</p>

<p>When there are no more event listeners attached to
    the <a href="#ondisplayavailablechange" title="ondisplayavailablechange"><code>ondisplayavailablechange</code></a> event handler, the user
    agent may stop such monitoring for the availability of secondary displays.</p>

<p class="note">This includes displays connected to the user agent's
    system via wired connections (e.g. HDMI, DVI etc.)  as well as via
    wireless technologies (e.g. MiraCast, DLNA or similar) that use a
    local or personal area network as a transport mechanism. The
    discovery can be performed by using operating system APIs that
    notify the user agent about display configuration changes or by
    means of network discovery for remote display technologies that
    are not handled by the operating system. In the latter case, the
    user agent or the operating system that the user agent runs on may
    prepare a video stream suitable for being decoded and displayed by
    the wirelessly-connected display.</p>

<h3 id="monitoring-for-availability-changes"><span class="secno">6.1 </span>Monitoring for Availability Changes</h3>

<p>When a user agent is to <dfn title="availability-monitoring" id="availability-monitoring">monitor for the availability of secondary displays</dfn>,
    it must execute the following steps.</p>

<ol class="algorithm">
    <li>Let <em>currentDisplayFound</em> be a boolean representing whether there are one more secondary displays
        available right now and let <em>currentDisplayFound</em> be false if it was not previously set.</li>
    <li>Query for available secondary displays that the user agent has access to.<p>
        <p class="note">An implementation
  of this API may chose to use operating system screen &amp; display information APIs or start an
            implementation dependent network discovery process.</p> </li>
    <li>Set <a href="#displayavailable" title="displayAvailable"><code>displayAvailable</code></a> to true if at least one suitable display was found in step 2, set to false
  otherwise.</li>
  <li>If <a href="#displayavailable" title="displayAvailable"><code>displayAvailable</code></a> is different
  from <em>currentDisplayFound</em>, <a href="http://dom.spec.whatwg.org/#concept-event-fire" data-anolis-spec="dom" title="concept-event-fire" class="external">fire</a> a new event <em>displayavailablechange</em> at
  the <code>navigator.presentation</code> object.</li>
    <li>Set <em>currentDisplayFound</em> to <a href="#displayavailable" title="displayAvailable"><code>displayAvailable</code></a>.</li>
  <li>Continue at step 1.</li>
</ol>

<p class="note">It is left to the implementation to determine a suitable polling/monitoring frequency or alternatively
    using notification mechanisms of the host OS for display availability changes.</p>

<h2 id="requesting-a-presentation-display"><span class="secno">7 </span>Requesting a Presentation Display</h2>

<p class="non-normative">When requesting a presentation display, the user agent returns a Promise and asynchronously
goes through the steps needed to open access to that display. The UA needs to check for availability. If a display is
available, the user agent asks the user for permission to use and select one. Then it can open a new browsing context
on that display and fulfils the Promise with the WindowProxy object of the new auxiliary browsing context as the value
of the Promise, otherwise rejects the Promise with an error.</p>

<p class="non-normative">A user agent shall only open and maintain a maximum of one presentation browsing context per
    available secondary display. If <a href="#requestshow"><code>requestShow</code></a> is called a second time and the user selects an available
    display that was previously in use by a previous call to <a href="#requestshow"><code>requestShow</code></a>, the user agent shall close the
    previous browsing context.</p>

<p>When the <a href="#requestshow"><code><span title="requestShow">requestShow<span></span></span></code></a> method is called, the user agent must execute the
following <dfn title="presentation-request-algorithm" id="presentation-request-algorithm">algorithm to request access to the presentation display</dfn>:</p>

<ol class="algorithm">
    <li>Let <em>promise</em> be a new Promise.</li>
    <li>Return <em>promise</em> and run the following steps asynchronously.</li>
    <li>Verify that the <a href="#availability-monitoring" title="availability-monitoring">availability monitoring algorithm</a> is running and
        that the value of <a href="#displayavailable"><code>displayAvailable</code></a> is true. If it is <code>false</code> or the algorithm
        is not running, jump to the step labeled <a href="#failure-step" title="failure-step">failure</a> below.</li>
    <li>Prompt the user's permission or check that the setting for allowing access to a presentation display enabled. If
        no permission is given, jump to the step labeled <a href="#failure-step" title="failure-step">failure</a> below. If the user never
        responds, this algorithm will never progress beyond this step.</li>
    <li>If more than one available display is found, present a selection to the user for choosing one of the available
        display.</li>
    <li>If the user cancels the selection, go to the <a href="#failure-step" title="failure-step">failure step</a>.</li>
    <li>Let the display that the user selected be called <dfn title="selected presentation display" id="selected-presentation-display">selected presentation
            display</dfn>.</li>
    <li>If there is already a presentation browsing context opened on the <a href="#selected-presentation-display" title="selected presentation
    display">selected presentation display</a>, <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#close-a-browsing-context" data-anolis-spec="w3c-html" title="close-browsing-context" class="external">close the existing presentation browsing context</a>.</li>
    <li>Open a new <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#auxiliary-browsing-context" data-anolis-spec="w3c-html" title="auxiliary browsing context" class="external">auxiliary browsing context</a> and present it
        fullscreen on the <span title="selected-presentation-display">selected presentation display</span>. The newly
        created <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#auxiliary-browsing-context" data-anolis-spec="w3c-html" title="auxiliary browsing context" class="external">auxiliary browsing context</a> is
        called <dfn title="presentation browsing context" id="presentation-browsing-context">presentation browsing context</dfn>.
    <li><a href="http://www.w3.org/html/wg/drafts/html/master/urls.html#resolve-a-url" data-anolis-spec="w3c-html" title="resolve a url" class="external">Resolve</a> the <code>url</code> to an absolute URL
            relative to the <a href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#entry-script" data-anolis-spec="w3c-html" title="entry script" class="external">entry
            script's</a> <a href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#script's-base-url" data-anolis-spec="w3c-html" title="script's base url" class="external">base
            URL</a>. Let <em>resolvedUrl</em> be the result of this resolution.
    <li>If the URL resolution fails, go to the <a href="#failure-step" title="failure-step">failure step</a>.
    <li><a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#navigate" data-anolis-spec="w3c-html" title="navigate" class="external">Navigate</a> the presentation browsing context to <em>resolvedUrl</em> with the <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#browsing-context" data-anolis-spec="w3c-html" title="browsing context" class="external">browsing context</a> of the
        <span title="incumbent script">incumbent script</span> as the <a href="http://www.w3.org/html/wg/drafts/html/master/history.html#source-browsing-context" data-anolis-spec="w3c-html" title="source browsing context" class="external">source browsing context</a>.
    <li><dfn title="success-step" id="success-step">Success</dfn>: Fulfil <em>promise</em> with
        the <span title="windowproxy"><code>WindowProxy</code></span> of the new <a href="#presentation-browsing-context" title="presentation browsing
                                                                                              context">presentation browsing context</a> as its value.</li>
    <li>Terminate these steps.</li>
    <li><dfn title="failure-step" id="failure-step">Failure</dfn>: Let <dfn title="presentation-error" id="presentation-error">error</dfn> be a
        new <code>DOMError</code>. The user agent must determine the error type in the following order of priority:</li>
    <ol>
        <li>If the user has denied permission to open a presentation display, <a href="#presentation-error" title="presentation-error">error</a>
            must be of type <code>SecurityError</code>.</li>
        <li><a href="#presentation-error" title="presentation-error">error</a> must be of type <code>NotSupportedError</code>.</li>
    </ol>
    <li>Reject <em>promise</em> with <em>error</em> as its value.</li>
</ol>

<h2 id="lifecycle-and-visibility-of-the-presentation-window"><span class="secno">8 </span>Lifecycle and Visibility of the Presentation Window</h2>

<h3 id="user-closing-the-presentation-window"><span class="secno">8.1 </span>User Closing the Presentation Window</h3>

<p>The user agent should provide a means for the user to close
    the <a href="#presentation-browsing-context" title="presentation browsing context">presentation browsing context</a>.</p>

<p class="note">In a PC scenario, this could be by means of an overlay on the secondary display with a close icon. In a mobile scenario where the user has no means of using a mouse cursor or other interaction with the secondary display, it could be an icon on the primary display.</p>

<p>If the user closes the <a href="#presentation-browsing-context" title="presentation browsing context">presentation browsing context</a>, the user
    agent should follow the regular algorithm for <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#close-a-browsing-context" data-anolis-spec="w3c-html" title="close-browsing-context" class="external">closing a browsing context</a>.</p>

<p class="note">This means, that the <span title="opener browsing context">opener browsing context</span> can register
    an <code>onunload</code> <a href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#eventhandler" data-anolis-spec="w3c-html" title="eventhandler" class="external">EventHandler</a> on
    the <a href="#presentation-browsing-context" title="presentation browsing context">presentation browsing context</a> to detect when the window gets
    closed.</p>

<p class="open-issue">There are currently two open issues: A user of this API can subscribe to the <code>onunload</code>
    event of the <a href="#presentation-browsing-context" title="presentation browsing context">presentation browsing context's</a> <code>Window</code>
    object but this event only fires if the URL loaded in the <a href="#presentation-browsing-context" title="presentation browsing context">presentation
    browsing context's</a> is from the same origin. Secondly, there is no such thing as an <code>onerror</code> event
    if the <a href="#presentation-browsing-context" title="presentation browsing context">presentation browsing context</a> is closed unexpectedly.</p>

<h3 id="programmatic-closing-of-the-presentation-window"><span class="secno">8.2 </span>Programmatic Closing of the Presentation Window</h3>

<p>Similarly, when the <code>close()</code> method of the <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#windowproxy" data-anolis-spec="w3c-html" title="windowproxy" class="external"><code>WindowProxy</code></a>
    is called, the user agent must behave as specified in the <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#dom-window-close" data-anolis-spec="w3c-html" title="dom-window-close" class="external">steps for the <code>close()</code> method</a> of
    the <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#window" data-anolis-spec="w3c-html" title="window" class="external"><code>Window</code></a> object.

<h3 id="display-availability-changes"><span class="secno">8.3 </span>Display Availability Changes</h3>

<p>If the display configuration of the user agent's host system changes so that the secondary display is not available
    any more, or if a display connected via the network becomes unreachable, and the user agent was showing an existing
    presentation browsing context on the display which is now unavailable, the user agent should follow the regular
    algorithm for <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#close-a-browsing-context" data-anolis-spec="w3c-html" title="close-browsing-context" class="external">closing a browsing
    context</a>.</p>

<h3 id="close-on-unload"><span class="secno">8.4 </span>Close on Unload</h3>

<p>When the browsing context from which  one or more <a href="#presentation-browsing-context" title="presentation browsing context">presentation browsing
        contexts</a> were opened is getting  <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#close-a-browsing-context" data-anolis-spec="w3c-html" title="close-browsing-context" class="external">closed</a>, the user agent should <span title="window-close-algorithm">close</span> all presentation browsing contexts that it opened.

<h2 id="security-considerations"><span class="secno">9 </span>Security Considerations</h2>

<p>The widespread use of popup blockers shows that the <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#dom-open" data-anolis-spec="w3c-html" title="dom-open" class="external"><code>window.open()</code></a> functionality was often abused to interrupt the user's
workflow with unsolicited advertising. It is clear that repeating this story should be avoided. Hence, when implementing
this specification, user agents shall give clear indication to the user that a site is requesting to open a presentation
display. User agents may prompt the user to give consent to displaying content on the selected presentation display.</p>

<p>User Agents may provide a setting which prevents pages from using
a <a href="#presentation-display" title="presentation display">presentation display</a>
altogether.</p>

<p>Opening the <a href="#presentation-browsing-context" title="presentation browsing context">presentation browsing context</a> follows the legacy
            behavior of <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#dom-open" data-anolis-spec="w3c-html" title="dom-open" class="external"><code>window.open()</code></a> and thus
            allows navigating to URLs that are not at the same origin as the browsing context of the incumbent
            script. This does not introduce any new security issues in itself. However, it would be desirable to only
            navigate to URLs in the presentation browsing context using the <a href="http://fetch.spec.whatwg.org/#concept-basic-fetch" data-anolis-spec="fetch" title="concept-basic-fetch" class="external">basic fetch algorithm</a> with the <em>CORS flag</em> flag set to true, but
            this would require changes to or a local redefinition of the
        <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#navigate" data-anolis-spec="w3c-html" title="navigate" class="external">navigation algorithm</a>.

<h2 class="no-num" id="references">References</h2>
<div id="anolis-references"><dl><dt id="refsDOM">[DOM]
<dd><cite><a href="http://dom.spec.whatwg.org/">DOM</a></cite>, Anne van Kesteren, Aryeh Gregor and Ms2ger. WHATWG.

<dt id="refsFETCH">[FETCH]
<dd><cite><a href="http://fetch.spec.whatwg.org/">Fetch</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsHTML5">[HTML5]
<dd><cite><a href="http://www.w3.org/html/wg/drafts/html/CR/">HTML5</a></cite>, Robin Berjon, Steve Faulkner, Travis Leithead et al.. W3C.

<dt id="refsRFC2119">[RFC2119]
<dd><cite><a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a></cite>, Scott Bradner. IETF.

<dt id="refsWEBIDL">[WEBIDL]
<dd><cite><a href="http://dev.w3.org/2006/webapi/WebIDL/">Web IDL</a></cite>, Cameron McCormack. W3C.

</dl></div>

<h2 class="no-num" id="acknowledgements">Acknowledgements</h2>

<p>Thanks to Wayne Carr and Anssi Kostiainen for input, thorough reviews and feedback to this draft.</p>



